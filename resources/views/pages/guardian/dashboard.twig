{% extends 'layouts/app.twig' %}
{% import 'macros/base.twig' as m %}
{% import 'macros/form.twig' as f %}

{% block title %}{{ __('guardian.dashboard') }}{% endblock %}

{% block content %}
<div class="container">
    {% include 'layouts/parts/messages.twig' %}

    <h1>{{ m.icon('people-fill') }} {{ __('guardian.dashboard') }}</h1>

    <div class="mb-4">
        <a href="{{ url('/guardian/register') }}" class="btn btn-primary">
            {{ m.icon('plus-circle') }} {{ __('guardian.register_minor') }}
        </a>
        <a href="{{ url('/guardian/link') }}" class="btn btn-outline-primary">
            {{ m.icon('link-45deg') }} {{ __('guardian.link_existing') }}
        </a>
    </div>

    {% if minors|length > 0 %}
        <div class="row g-4">
            {% for data in minors %}
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>
                                {{ m.icon('person') }}
                                <strong>{{ data.user.name }}</strong>
                            </span>
                            {% if data.isPrimary %}
                                <span class="badge bg-primary">{{ __('guardian.primary') }}</span>
                            {% endif %}
                        </div>
                        <div class="card-body">
                            {% if data.category %}
                                <p class="mb-2">
                                    <span class="badge bg-info">{{ data.category.name }}</span>
                                </p>
                            {% endif %}

                            <p class="mb-2">
                                {% if data.consentApproved %}
                                    <span class="text-success">
                                        {{ m.icon('check-circle-fill') }} {{ __('guardian.consent_approved') }}
                                    </span>
                                {% else %}
                                    <span class="text-warning">
                                        {{ m.icon('exclamation-triangle-fill') }} {{ __('guardian.consent_pending') }}
                                    </span>
                                {% endif %}
                            </p>

                            {% if data.restrictions.maxHoursPerDay is not null %}
                                <p class="mb-2">
                                    <small class="text-muted">
                                        {{ __('guardian.hours_today') }}:
                                        {{ data.dailyHoursUsed|number_format(1) }} / {{ data.restrictions.maxHoursPerDay }}h
                                    </small>
                                </p>
                            {% endif %}

                            {% if data.upcomingShifts|length > 0 %}
                                <p class="mb-0">
                                    <small>
                                        {{ m.icon('calendar-event') }}
                                        {{ __('guardian.upcoming_shifts', {'count': data.upcomingShifts|length}) }}
                                    </small>
                                </p>
                            {% endif %}
                        </div>
                        <div class="card-footer">
                            <a href="{{ url('/guardian/minor/' ~ data.user.id) }}" class="btn btn-sm btn-outline-primary">
                                {{ m.icon('eye') }} {{ __('guardian.view') }}
                            </a>
                            <a href="{{ url('/guardian/minor/' ~ data.user.id ~ '/edit') }}" class="btn btn-sm btn-outline-secondary">
                                {{ m.icon('pencil') }} {{ __('guardian.edit') }}
                            </a>
                            {% if not data.consentApproved %}
                                <a href="{{ url('/guardian/minor/' ~ data.user.id ~ '/consent') }}" class="btn btn-sm btn-outline-warning">
                                    {{ m.icon('file-text') }} {{ __('guardian.consent_form') }}
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        {{ m.info(__('guardian.no_minors_yet')) }}
    {% endif %}
</div>
{% endblock %}
